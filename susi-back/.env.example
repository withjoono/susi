# ================================
# 거북스쿨 백엔드 환경 변수 설정
# ================================
# 이 파일을 복사하여 .env.development 파일을 생성하세요
# 실제 값으로 대체 후 사용하세요
# ⚠️ 중요: .env.* 파일은 절대 Git에 커밋하지 마세요!

# ================================
# 애플리케이션 설정
# ================================
# 환경: development | production | test
NODE_ENV=development

# 서버 포트 (기본값: 4001)
PORT=4001

# ================================
# 데이터베이스 설정 (PostgreSQL)
# ================================
# 데이터베이스 타입 (postgres 권장)
DB_TYPE=postgres

# 데이터베이스 호스트
# - Docker 사용 시: 127.0.0.1 또는 localhost
# - Cloud SQL 사용 시: 127.0.0.1 (Cloud SQL Proxy 사용)
# - 직접 연결: Cloud SQL Public IP 또는 Private IP
DB_HOST=127.0.0.1

# 데이터베이스 포트 (PostgreSQL 기본값: 5432)
DB_PORT=5432

# 데이터베이스 사용자명
# Docker 기본값: tsuser
DB_USER=YOUR_DB_USER_HERE

# 데이터베이스 비밀번호
# ⚠️ 주의: 강력한 비밀번호 사용 권장 (영문+숫자+특수문자 조합)
DB_PASSWORD=YOUR_DB_PASSWORD_HERE

# 데이터베이스 이름
# 개발: geobukschool_dev
# 프로덕션: geobukschool_prod
DB_NAME=geobukschool_dev

# 데이터베이스 스키마 자동 동기화
# ⚠️ 중요: 프로덕션에서 절대 true로 설정하지 마세요!
# - false: 마이그레이션 사용 (권장)
# - true: 엔티티 기반 자동 스키마 생성 (개발 전용)
DB_SYNCHRONIZE=false

# Cloud SQL 연결 설정 (선택사항)
# Cloud SQL Proxy를 사용하는 경우 아래 설정 추가
# CLOUD_SQL_CONNECTION_NAME=project-id:region:instance-name
# CLOUD_SQL_SOCKET_PATH=/cloudsql/project-id:region:instance-name

# ================================
# 인증 설정 (JWT)
# ================================
# JWT Access Token 시크릿 키
# 생성 방법: node -e "console.log(require('crypto').randomBytes(64).toString('base64'))"
# ⚠️ 주의: 64자 이상 base64 인코딩된 랜덤 문자열 사용
AUTH_JWT_SECRET=YOUR_JWT_SECRET_HERE

# JWT Access Token 만료 시간 (밀리초)
# 기본값: 7200000 (2시간)
AUTH_JWT_TOKEN_EXPIRES_IN=7200000

# JWT Refresh Token 시크릿 키
# 생성 방법: node -e "console.log(require('crypto').randomBytes(64).toString('base64'))"
# ⚠️ 주의: Access Token과 다른 시크릿 사용
AUTH_REFRESH_SECRET=YOUR_REFRESH_SECRET_HERE

# JWT Refresh Token 만료 시간 (밀리초)
# 기본값: 5184000000 (60일)
AUTH_REFRESH_TOKEN_EXPIRES_IN=5184000000

# ================================
# 결제 서비스 (Iamport)
# ================================
# Iamport REST API 키
# 발급: https://admin.iamport.kr > 시스템설정 > 내정보
IMP_KEY=YOUR_IMP_KEY_HERE

# Iamport REST API Secret
IMP_SECRET=YOUR_IMP_SECRET_HERE

# Iamport 스토어 코드
# PG사별로 다를 수 있음 (예: INIpayTest, kakaopay 등)
IMP_STORE_CODE=YOUR_STORE_CODE_HERE

# ================================
# SMS 서비스 (NHN Cloud SENS)
# ================================
# NHN Cloud Access Key ID
# 발급: https://console.nhncloud.com > 마이페이지 > API 보안 설정
NHN_ACCESS_KEY=YOUR_NHN_ACCESS_KEY_HERE

# NHN Cloud Secret Key
# ⚠️ 주의: 생성 시 한 번만 표시되므로 반드시 저장
NHN_SECRET_KEY=YOUR_NHN_SECRET_KEY_HERE

# NHN Cloud SENS Service ID
# 발급: NHN Cloud Console > SMS > 프로젝트 생성 시 발급
NHN_SERVICE_ID=YOUR_NHN_SERVICE_ID_HERE

# SMS 발신 번호
# 형식: 010-1234-5678 (하이픈 포함 또는 제외)
# ⚠️ 주의: NHN Cloud에 사전 등록된 발신번호만 사용 가능
SMS_SENDER_PHONE=YOUR_SENDER_PHONE_HERE

# SMS 테스트 모드
# Y: 실제 전송 안 함 (개발용)
# N: 실제 SMS 전송 (프로덕션용)
SMS_TEST_MODE=Y

# ================================
# Google Cloud Storage (GCS)
# ================================
# GCS 프로젝트 ID
# GCP Console > 프로젝트 선택 > 프로젝트 ID 확인
GCS_PROJECT_ID=YOUR_GCS_PROJECT_ID_HERE

# GCS 버킷 이름
# 생성: GCP Console > Cloud Storage > 버킷 만들기
# 예: geobukschool-files-dev, geobukschool-files-prod
GCS_BUCKET_NAME=YOUR_GCS_BUCKET_NAME_HERE

# GCS 서비스 계정 키 파일 경로
# 생성: GCP Console > IAM 및 관리자 > 서비스 계정 > 키 만들기 (JSON)
# ⚠️ 주의: 절대 경로 또는 프로젝트 루트 기준 상대 경로 사용
# 예: ./config/gcs-service-account-key.json
GCS_KEY_FILENAME=./path/to/service-account-key.json

# GCS 퍼블릭 URL 베이스
# 형식: https://storage.googleapis.com/버킷이름
GCS_PUBLIC_URL=https://storage.googleapis.com/YOUR_BUCKET_NAME_HERE

# ================================
# 캐싱 (Redis)
# ================================
# Redis 호스트
# - Docker 사용 시: localhost 또는 127.0.0.1
# - Cloud Redis 사용 시: Redis 인스턴스 IP
REDIS_HOST=localhost

# Redis 포트 (기본값: 6379)
REDIS_PORT=6379

# Redis 비밀번호 (선택사항)
# Cloud Redis 또는 보안이 필요한 경우 설정
# REDIS_PASSWORD=YOUR_REDIS_PASSWORD_HERE

# Redis 데이터베이스 번호 (0-15)
REDIS_DB=0

# Redis TTL (Time To Live) - 초 단위
# 기본값: 5 (5초)
REDIS_TTL=5

# ================================
# Firebase Admin SDK (선택사항)
# ================================
# Firebase 프로젝트 ID
# Firebase Console > 프로젝트 설정 > 프로젝트 ID
# FIREBASE_PROJECT_ID=YOUR_FIREBASE_PROJECT_ID_HERE

# Firebase 서비스 계정 키 파일 경로
# 생성: Firebase Console > 프로젝트 설정 > 서비스 계정 > 새 비공개 키 생성
# ⚠️ 주의: 프로젝트 루트에 firebase-service-account-key.json 배치
# 파일이 없으면 Firebase 기능이 비활성화됨 (정상 동작)
# FIREBASE_CREDENTIALS_PATH=./firebase-service-account-key.json

# ================================
# 모니터링 & 에러 추적
# ================================
# Sentry DSN (Data Source Name)
# 발급: Sentry.io > 프로젝트 설정 > Client Keys (DSN)
# 형식: https://[key]@[organization].ingest.sentry.io/[project-id]
SENTRY_DSN=YOUR_SENTRY_DSN_HERE

# Sentry 환경 (선택사항, 기본값: NODE_ENV 사용)
# SENTRY_ENVIRONMENT=development

# Sentry 트레이스 샘플링 비율 (0.0 - 1.0)
# 개발: 1.0 (100%), 프로덕션: 0.1 (10%) 권장
# SENTRY_TRACES_SAMPLE_RATE=1.0

# Slack 웹훅 URL (알림용, 선택사항)
# 생성: Slack > 앱 관리 > Incoming Webhooks > Add to Slack
# 형식: https://hooks.slack.com/services/T00000000/B00000000/XXXXXXXXXXXXXXXXXXXX
SLACK_WEBHOOK=YOUR_SLACK_WEBHOOK_URL_HERE

# ================================
# 모바일 앱 보안 (하이브리드 앱)
# ================================
# 앱 API Key (모바일 앱 전용 인증)
# 생성 방법: node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
# ⚠️ 앱과 백엔드에 동일한 값 설정 필요
APP_API_KEY=YOUR_APP_API_KEY_HERE

# 앱 시그니처 시크릿 (HMAC 서명 검증용)
# 생성 방법: node -e "console.log(require('crypto').randomBytes(64).toString('hex'))"
# 앱 위변조 감지에 사용
APP_SECRET=YOUR_APP_SECRET_HERE

# ================================
# 데이터 암호화
# ================================
# 민감정보 암호화 키 (전화번호, 이메일, 주민번호 등)
# 생성 방법: node -e "console.log(require('crypto').randomBytes(64).toString('hex'))"
# ⚠️ 중요: 이 키를 잃어버리면 암호화된 데이터를 복구할 수 없습니다!
# ⚠️ 프로덕션에서 반드시 설정 필요
ENCRYPTION_KEY=YOUR_ENCRYPTION_KEY_HERE

# ================================
# CORS 설정 (선택사항)
# ================================
# 허용된 Origin (쉼표로 구분)
# 기본값: src/main.ts의 화이트리스트 사용
# CORS_ALLOWED_ORIGINS=https://admin2.turtleskool.com,https://turtleskool.com

# ================================
# 쿠키 설정 (HttpOnly Cookie 인증)
# ================================
# 쿠키 도메인 (선택사항)
# 프로덕션에서 서브도메인 간 쿠키 공유가 필요한 경우 설정
# 예: .turtleskool.com (앞에 점 필수)
# 설정하지 않으면 현재 도메인으로 자동 설정
# COOKIE_DOMAIN=.turtleskool.com

# ================================
# 로깅 설정 (선택사항)
# ================================
# 로그 레벨
# 옵션: error | warn | info | debug | verbose
# LOG_LEVEL=info

# 로그 파일 디렉토리
# LOG_DIR=./logs

# ================================
# 개발 도구 (선택사항)
# ================================
# TypeORM 쿼리 로깅
# true: SQL 쿼리 콘솔 출력 (개발용)
# false: 로깅 비활성화 (프로덕션용)
# TYPEORM_LOGGING=false

# Swagger API 문서 활성화
# true: /swagger 엔드포인트 활성화
# false: Swagger 비활성화 (프로덕션 권장)
# SWAGGER_ENABLED=true

# ================================
# 보안 체크리스트
# ================================
# ✅ 모든 시크릿 키를 강력한 랜덤 값으로 설정
# ✅ DB_SYNCHRONIZE=false 확인 (프로덕션)
# ✅ .env.* 파일이 .gitignore에 포함되어 있는지 확인
# ✅ 실제 자격 증명을 코드에 하드코딩하지 않음
# ✅ GCS/Firebase 서비스 계정 키 파일 권한 제한 (600)
# ✅ 프로덕션 환경에서 ALIGO_TEST_MODE=false 설정
# ✅ 프로덕션 환경에서 강력한 DB 비밀번호 사용

# ================================
# 참고 자료
# ================================
# - 개발 환경 설정: ./DEVELOPMENT-SETUP.md
# - 로깅 가이드라인: ./LOGGING-GUIDELINES.md
# - API 문서: http://localhost:4001/swagger (서버 실행 후)

# AI 예측 서비스 URL (별도 Cloud Run 배포)
PREDICTION_API_URL=http://localhost:8000

# ================================
# OpenAI API (학생부 파싱용)
# ================================
# OpenAI API 키
# 발급: https://platform.openai.com/api-keys
# ⚠️ 주의: API 키를 안전하게 관리하세요
OPENAI_API_KEY=YOUR_OPENAI_API_KEY_HERE

# ================================
# OAuth 2.0 + OIDC 설정 (Hub 연동)
# ================================
# Hub 백엔드 URL
# 개발: http://localhost:4000
# 프로덕션: https://hub.turtleskool.com
HUB_BASE_URL=http://localhost:4000

# OAuth 클라이언트 ID
# Hub 백엔드에 등록된 Susi 클라이언트 ID
OAUTH_CLIENT_ID=susi-client

# OAuth 클라이언트 시크릿
# Hub 백엔드에 등록된 Susi 클라이언트 시크릿
# ⚠️ 주의: 프로덕션에서는 강력한 시크릿 사용 필요
OAUTH_CLIENT_SECRET=susi-secret-change-in-production

# OAuth 리다이렉트 URI
# Hub OAuth 인증 완료 후 돌아올 Susi 백엔드 콜백 URL
# 개발: http://localhost:4002/api/auth/oauth/callback
# 프로덕션: https://api-susi.turtleskool.com/api/auth/oauth/callback
OAUTH_REDIRECT_URI=http://localhost:4002/api/auth/oauth/callback

# OAuth 요청 스코프
# openid: 기본 인증 정보
# profile: 이름, 닉네임 등 프로필 정보
# email: 이메일 주소
OAUTH_SCOPE=openid profile email
